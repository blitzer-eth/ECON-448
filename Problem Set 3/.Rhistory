)
ggplot(prop_ever_married_age, aes(x = AGE, y = prop_ever_married)) +
geom_line() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
title = "Proportion of women ever married by age (18–65)"
) +
theme_minimal()
# Q4.2: ever_married indicator and proportion by age
library(dplyr)
library(ggplot2)
# IPUMS MARST usually: 1 = single, 2 = married/in union, 3 = separated, 4 = divorced, 5 = widowed
df_4_2 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)  # single, married, divorced
) %>%
mutate(
ever_married = as.integer(MARST %in% c(2, 4))
)
prop_ever_married_age <- df_4_2 %>%
group_by(AGE) %>%
summarise(
prop_ever_married = mean(ever_married, na.rm = TRUE),
.groups = "drop"
)
ggplot(prop_ever_married_age, aes(x = AGE, y = prop_ever_married)) +
geom_line() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
title = "Proportion of women ever married by age (18–65)"
)
# Q4.2: ever_married indicator and proportion by age
library(dplyr)
library(ggplot2)
# IPUMS MARST usually: 1 = single, 2 = married/in union, 3 = separated, 4 = divorced, 5 = widowed
df_4_2 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)  # single, married, divorced
) %>%
mutate(
ever_married = as.integer(MARST %in% c(2, 4))
)
prop_ever_married_age <- df_4_2 %>%
group_by(AGE) %>%
summarise(
prop_ever_married = mean(ever_married, na.rm = TRUE),
.groups = "drop"
)
ggplot(prop_ever_married_age, aes(x = AGE, y = prop_ever_married)) +
geom_line() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
title = "Proportion of women ever married by age (18–65)"
) +
theme_minimal()
setwd("C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 3")
df_raw <- read.csv(gzfile("ipumsi_00003.csv.gz"))
names(df_raw)
setwd("C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 3")
df_raw <- read.csv(gzfile("ipumsi_00003.csv.gz"))
names(df_raw)
library(dplyr)
library(stargazer)
library(ggplot2)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, LABFORCE, YRSCHOOL, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4_2 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)  # single, married, divorced
) %>%
mutate(
ever_married = as.integer(MARST %in% c(2, 4))
)
prop_ever_married_age <- df_4_2 %>%
group_by(AGE) %>%
summarise(
prop_ever_married = mean(ever_married, na.rm = TRUE),
.groups = "drop"
)
ggplot(prop_ever_married_age, aes(x = AGE, y = prop_ever_married)) +
geom_line() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
title = "Proportion of women ever married by age (18–65)"
) +
theme_minimal()
df_4_2 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)  # 1 = single, 2 = married, 4 = divorced
) %>%
mutate(
ever_married = as.integer(MARST %in% c(2, 4))
)
prop_ever_married_age <- df_4_2 %>%
group_by(AGE) %>%
summarise(
prop_ever_married = mean(ever_married, na.rm = TRUE),
.groups = "drop"
)
ggplot(prop_ever_married_age, aes(x = AGE, y = prop_ever_married)) +
geom_line() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
title = "Proportion of women ever married by age (18–65)"
) +
theme_minimal()
# Q4.3: Association between marital status and employment
library(dplyr)
library(stargazer)
df_4_3 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)   # single, married, divorced
) %>%
mutate(
employed = as.integer(EMPSTAT == 1),  # 1 = employed
married  = as.integer(MARST == 2),
divorced = as.integer(MARST == 4)
)
# linear probability model; reference group = single women
model_4_3 <- lm(employed ~ married + divorced, data = df_4_3)
stargazer(
model_4_3,
type = "text",
title = "Regression of employment on marital status",
dep.var.labels = "Employed (0/1)",
covariate.labels = c("Married", "Divorced")
)
df_4_1 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4_1 %>%
select(AGE, MARST, EMPSTAT, LABFORCE, YRSCHOOL, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4_3 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)   # single, married, divorced
) %>%
mutate(
employed = as.integer(EMPSTAT == 1),  # 1 = employed
married  = as.integer(MARST == 2),
divorced = as.integer(MARST == 4)
)
# linear probability model; reference group = single women
model_4_3 <- lm(employed ~ married + divorced, data = df_4_3)
stargazer(
model_4_3,
type = "text",
title = "Regression of employment on marital status",
dep.var.labels = "Employed (0/1)",
covariate.labels = c("Married", "Divorced")
)
# Q4.3: Association between marital status and employment
library(dplyr)
library(stargazer)
df_4_3 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)   # single, married, divorced
) %>%
mutate(
employed = as.integer(EMPSTAT == 1),  # 1 = employed
married  = as.integer(MARST == 2),
divorced = as.integer(MARST == 4)
)
# linear probability model; reference group = single women
model_4_3 <- lm(employed ~ married + divorced, data = df_4_3)
stargazer(
model_4_3,
type = "text",
title = "Regression of employment on marital status",
dep.var.labels = "Employed (0/1)",
covariate.labels = c("Married", "Divorced")
)
# Q4.3: Association between marital status and employment (no stargazer)
library(dplyr)
df_4_3 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST %in% c(1, 2, 4)   # single, married, divorced
) %>%
mutate(
employed = as.integer(EMPSTAT == 1),
married  = as.integer(MARST == 2),
divorced = as.integer(MARST == 4)
)
model_4_3 <- lm(employed ~ married + divorced, data = df_4_3)
# Basic regression output
summary(model_4_3)
# Q4.4: Effect of unilateral divorce on married women's employment and earnings
library(dplyr)
library(stargazer)
# 1. Create a unilateral-divorce dummy by state (FILL IN correct codes)
# Example/template:
# unilat_states <- c(484001, 484002, ...)  # replace with actual GEO1_MX codes
unilat_states <- c()  # TODO: put the real state codes here
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings    = log(INCEARN_clean + 1)
)
# Regression 1: employment
model_emp <- lm(employed ~ unilat_divorce, data = df_4_4)
# Regression 2: log earnings
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
stargazer(
model_emp, model_earn,
type = "text",
title = "Unilateral divorce, married women's employment and earnings",
dep.var.labels = c("Employed (0/1)", "Log earnings"),
covariate.labels = c("Unilateral divorce state"),
column.labels = c("Employment", "Earnings"),
keep.stat = c("n", "rsq")
)
# Q4.4: Unilateral divorce and married women's employment/earnings (no stargazer)
library(dplyr)
# TODO: replace with the actual GEO1_MX codes for unilateral divorce states
unilat_states <- c()
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings    = log(INCEARN_clean + 1)
)
model_emp  <- lm(employed ~ unilat_divorce, data = df_4_4)
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
# Print regression tables using base R
summary(model_emp)
summary(model_earn)
# Q4.4: Unilateral divorce, married women's employment and earnings
library(dplyr)
library(broom)
library(knitr)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # only currently married women (follow the hint)
) %>%
mutate(
employed      = as.integer(EMPSTAT == 1),             # 1 = employed
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings   = log(INCEARN_clean + 1)                # handle zeros / NA
)
# Regression 1: employment on unilateral divorce
model_emp <- lm(employed ~ unilat_divorce, data = df_4_4)
# Q4.4: Unilateral divorce (Mexico City only), married women's employment and earnings
library(dplyr)
library(broom)
library(knitr)
# Treat Mexico City as the only unilateral divorce state
# In your data GEO1_MX == 484001 for that state
unilat_states <- c(484001)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married women (follow the hint)
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings    = log(INCEARN_clean + 1)
)
# Regression 1: employment on unilateral divorce
model_emp  <- lm(employed    ~ unilat_divorce, data = df_4_4)
# Regression 2: log earnings on unilateral divorce
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
# Put both models into one simple table
tab_emp  <- tidy(model_emp)  %>% mutate(model = "Employment")
tab_earn <- tidy(model_earn) %>% mutate(model = "Log earnings")
results_4_4 <- bind_rows(tab_emp, tab_earn) %>%
select(model, term, estimate, std.error, statistic, p.value)
kable(results_4_4, digits = 3,
caption = "Effect of unilateral divorce (Mexico City) on married women's employment and earnings")
setwd("C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 3")
df_raw <- read.csv(gzfile("ipumsi_00003.csv.gz"))
names(df_raw)
library(dplyr)
library(stargazer)
library(ggplot2)
library(broom)
library(knitr)
# Treat Mexico City as the unilateral divorce state
unilat_states <- c(484001)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married women
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings    = log(INCEARN_clean + 1)
)
model_emp  <- lm(employed    ~ unilat_divorce, data = df_4_4)
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
tab_emp  <- tidy(model_emp)  %>% mutate(model = "Employment")
tab_earn <- tidy(model_earn) %>% mutate(model = "Log earnings")
results_4_4 <- bind_rows(tab_emp, tab_earn) %>%
select(model, term, estimate, std.error, statistic, p.value)
kable(results_4_4, digits = 3,
caption = "Effect of unilateral divorce (Mexico City) on married women's employment and earnings")
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
# Treat Mexico City as the unilateral divorce state
unilat_states <- c(484001)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married women
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
ln_earnings    = log(INCEARN + 1)
)
model_emp  <- lm(employed    ~ unilat_divorce, data = df_4_4)
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
tab_emp  <- tidy(model_emp)  %>% mutate(model = "Employment")
tab_earn <- tidy(model_earn) %>% mutate(model = "Log earnings")
results_4_4 <- bind_rows(tab_emp, tab_earn) %>%
select(model, term, estimate, std.error, statistic, p.value)
kable(
results_4_4,
digits  = 3,
caption = "Effect of unilateral divorce (Mexico City) on married women's employment and earnings"
)
# Treat Mexico City as the unilateral divorce state
unilat_states <- c(484001)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married women
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings    = log(INCEARN_clean + 1)
)
model_emp  <- lm(employed    ~ unilat_divorce, data = df_4_4)
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
tab_emp  <- tidy(model_emp)  %>% mutate(model = "Employment")
tab_earn <- tidy(model_earn) %>% mutate(model = "Log earnings")
results_4_4 <- bind_rows(tab_emp, tab_earn) %>%
select(model, term, estimate, std.error, statistic, p.value)
kable(results_4_4, digits = 3,
caption = "Effect of unilateral divorce (Mexico City) on married women's employment and earnings")
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65)
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65) %>%
mutate(
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN)
)
# Variables used
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN_clean, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
df_4 <- df_raw %>%
filter(AGE >= 18, AGE <= 65)
analysis_vars <- df_4 %>%
select(AGE, MARST, EMPSTAT, INCEARN, GEO1_MX)
stargazer(
analysis_vars,
type = "text",
summary.stat = c("mean", "sd", "min", "max"),
title = "Summary statistics for analysis variables"
)
# Treat Mexico City as the unilateral divorce state
unilat_states <- c(484001)
df_4_4 <- df_raw %>%
filter(
AGE >= 18, AGE <= 65,
MARST == 2   # currently married women
) %>%
mutate(
unilat_divorce = as.integer(GEO1_MX %in% unilat_states),
employed       = as.integer(EMPSTAT == 1),
INCEARN_clean  = ifelse(INCEARN >= 99999998, NA, INCEARN), # I noticed that the maximum of INCEARN in my summary statistics is 99,999,999. I searched online and learned that very large values like this are special codes for missing or top coded income
ln_earnings    = log(INCEARN_clean + 1)
)
model_emp  <- lm(employed    ~ unilat_divorce, data = df_4_4)
model_earn <- lm(ln_earnings ~ unilat_divorce, data = df_4_4)
tab_emp  <- tidy(model_emp)  %>% mutate(model = "Employment")
tab_earn <- tidy(model_earn) %>% mutate(model = "Log earnings")
results_4_4 <- bind_rows(tab_emp, tab_earn) %>%
select(model, term, estimate, std.error, statistic, p.value)
kable(results_4_4, digits = 3,
caption = "Effect of unilateral divorce (Mexico City) on married women's employment and earnings")
