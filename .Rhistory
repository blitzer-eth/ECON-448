library(dplyr)
library(ggplot2)
library(readr)
library(knitr)
library(stargazer)
library(scales)
library(modelsummary)
library(kableExtra)
## 1. Load Data
ipums_file <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Final Project/ipumsi_00004.csv.gz"
df_raw <- read.csv(gzfile(ipums_file))
## 2. Sample Restrictions + Variable Construction
df <- df_raw %>%
filter(
COUNTRY %in% c(76, 484),
AGE >= 18, AGE <= 65,
SEX == 2
) %>%
mutate(
country = ifelse(COUNTRY == 484, "Mexico", "Brazil"),
year = YEAR,
ever_married = as.integer(MARST >= 2),
married = as.integer(MARST == 2),
divorced = as.integer(MARST == 4),
employed = as.integer(EMPSTAT == 1),
INCEARN_clean = ifelse(INCEARN >= 99999998, NA, INCEARN),
ln_earnings = log(INCEARN_clean + 1)
)
## 3. Summary Statistics Table
tbl_sum <- df %>%
group_by(country, year) %>%
summarise(
N = n(),
mean_AGE = mean(AGE, na.rm = TRUE),
sd_AGE = sd(AGE, na.rm = TRUE),
min_AGE = min(AGE, na.rm = TRUE),
max_AGE = max(AGE, na.rm = TRUE),
mean_YRSCHOOL = mean(YRSCHOOL, na.rm = TRUE),
sd_YRSCHOOL = sd(YRSCHOOL, na.rm = TRUE),
mean_CHBORN = mean(CHBORN, na.rm = TRUE),
sd_CHBORN = sd(CHBORN, na.rm = TRUE),
mean_employed = mean(employed, na.rm = TRUE),
mean_ln_earn = mean(ln_earnings, na.rm = TRUE),
.groups = "drop"
)
library(knitr)
library(kableExtra)
kable(
tbl_sum,
digits = 3,
caption = "Table 1. Summary statistics for women ages 18–65 by country and year",
format = "html"
) %>%
kable_styling(full_width = FALSE)
## 4. Figure: Proportion Ever Married by Age
df_ever <- df %>%
group_by(country, year, AGE) %>%
summarise(
prop_ever = mean(ever_married, na.rm = TRUE),
.groups = "drop"
)
ggplot(df_ever, aes(x = AGE, y = prop_ever, color = factor(year), group = year)) +
geom_line() +
facet_wrap(~ country) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
labs(
x = "Age",
y = "Proportion ever married",
color = "Year",
title = "Proportion of Women Ever Married by Age, Country, and Year"
) +
theme_bw()
## 5. Employment Regressions
models_emp <- list(
"Pooled"            = m_emp1,
"With interactions" = m_emp2
)
## 5. Employment Regressions
m_emp1 <- lm(
employed ~ married + divorced + AGE + I(AGE^2) + YRSCHOOL + CHBORN + country + factor(year),
data = df
)
m_emp2 <- lm(
employed ~ married*country + divorced*country + AGE + I(AGE^2) + YRSCHOOL + CHBORN + factor(year),
data = df
)
models_emp <- list(
"Pooled"            = m_emp1,
"With interactions" = m_emp2
)
coef_map_emp <- c(
"married" = "Married",
"divorced" = "Divorced",
"married:countryMexico" = "Married × Mexico",
"divorced:countryMexico" = "Divorced × Mexico",
"AGE" = "Age",
"I(AGE^2)" = "Age squared",
"YRSCHOOL" = "Years of schooling",
"CHBORN" = "Children ever born",
"countryMexico" = "Mexico (country dummy)"
)
modelsummary(
models_emp,
title = "Table 2. Association Between Marital Status and Employment",
output = "kableExtra",
coef_map = coef_map_emp,
statistic = "({std.error})",
stars = TRUE,
gof_omit = "IC|Log|Adj|F|RMSE"
) %>%
kable_styling(full_width = FALSE)
## 6. Earnings Regression (Employed Women Only)
coef_map_earn <- c(
"married" = "Married",
"divorced" = "Divorced",
"AGE" = "Age",
"I(AGE^2)" = "Age squared",
"YRSCHOOL" = "Years of schooling",
"CHBORN" = "Children ever born",
"countryMexico" = "Mexico (country dummy)"
)
modelsummary(
list("Employed women only" = m_earn),
title = "Table 3. Association Between Marital Status and Log Earnings (Employed Women Only)",
output = "kableExtra",
coef_map = coef_map_earn,
statistic = "({std.error})",
stars = TRUE,
gof_omit = "IC|Log|Adj|F|RMSE"
) %>%
kable_styling(full_width = FALSE)
## 6. Earnings Regression (Employed Women Only)
df_working <- df %>%
filter(employed == 1, !is.na(ln_earnings))
m_earn <- lm(
ln_earnings ~ married + divorced +
AGE + I(AGE^2) + YRSCHOOL + CHBORN +
country + factor(year),
data = df_working
)
coef_map_earn <- c(
"married" = "Married",
"divorced" = "Divorced",
"AGE" = "Age",
"I(AGE^2)" = "Age squared",
"YRSCHOOL" = "Years of schooling",
"CHBORN" = "Children ever born",
"countryMexico" = "Mexico (country dummy)"
)
modelsummary(
list("Employed women only" = m_earn),
title = "Table 3. Association Between Marital Status and Log Earnings (Employed Women Only)",
output = "kableExtra",
coef_map = coef_map_earn,
statistic = "({std.error})",
stars = TRUE,
fmt = 3,
gof_omit = "IC|Log|Adj|F|RMSE"
) %>%
kable_styling(full_width = FALSE)
library(dplyr)
library(ggplot2)
library(readr)
library(knitr)
library(stargazer)
library(scales)
library(modelsummary)
library(kableExtra)
