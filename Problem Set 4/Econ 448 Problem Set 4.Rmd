---
title: "Econ 448 Problem Set 4"
author: "Alex Lin"
date: "`r format(Sys.time(), '%m/%d/%Y')`"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
## Concept Questions

1. In a bargaining model of household decision-making, the couple jointly maximizes the following utility function:
$U=[U(C_m)- T_m]*[U(C_f)- T_f]$

Subject to $Y= C_m+C_f$, where Y is total family income
    
Person f is the female partner and m is the male partner

  1.1 In Nancy Qian’s paper, which variable in the preceding model changes as a direct consequence of an increase in tea prices in China?
  
  Answer:
  
  An increase in tea prices raises women’s potential earnings and their outside options.
  
  The variable that directly varies in this bargaining setup is $T_f$, the female partner's threat point (or bargaining power).
    
  1.2 What other model variables will be affected following this change?
  
  Answer:
  
  When $T_f$ increases, the Nash product $[U(C_m) - T_m] \times [U(C_f) - T_f]$ is maximized subject to the same budget $Y = C_m + C_f$, but with a higher $T_f$.
  
  To restore optimality:
  
  - The consumption allocation shifts: $C_f$ increases and $C_m$ decreases, holding $Y$ fixed.
  - As a result, $U(C_f)$ rises and $U(C_m)$ may fall.
    
  So the affected variables in the simple model are:
  
  - $C_f$
  - $C_m$
  - $U(C_f)$
  - $U(C_m)$
  
  while $Y$ and $T_m$ are taken as given.
    
  1.3 What do Qian’s findings regarding girls’ survival suggest about the female partner’s preferences in this model?
  
  Answer:
  
  Qian finds that when women’s bargaining power rises (via higher tea prices and thus higher $T_f$), the survival rate of girls improves, while boys are not harmed.

  In the context of this model, that implies:

   - The female partner’s utility $U(C_f)$ gives relatively high value to daughters’ survival, health, and well-being.
   - When her $T_f$ increases and she gets a larger share of household resources (higher $C_f$), she chooses to allocate more resources toward girls.

  This suggests that the female partner’s preferences put more weight on daughters than the male partner’s preferences do.
    
  1.4 How does Qian justify rejecting the unitary model of household decision-making in this paper?
  
  Answer:
  
  Only total income $Y$ and prices matter in a unitary model since the household acts as though it maximizes a single utility function; the distribution of resources within the household shouldn't be influenced by who makes the money.
    
  Qian shows:
  
  - In areas where tea production is female-labor-intensive, higher tea prices (which raise women’s income and $T_f$) lead to better outcomes for girls (higher survival, better investments).
  - Girls do not benefit in the same ways from comparable increases in income that primarily benefit men (such as from male-intensive industries or crops).
    
  Because intrahousehold outcomes change when the identity of the income earner changes, not just when total $Y$ changes, the unitary model’s key prediction is violated.


## Data Analysis Questions

These questions refer to the data set "1% sample Ethiopia ever-married women age 15+" available via the Econ 448 class account from ipums.org.  Please download the data and answer the following questions.

```{r}
library(tidyverse)

data_path <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"

raw <- readr::read_csv(data_path)
```


1. Clean your data, as shown in the IPUMS and Child Mortality Labs. Create a formatted table of summary statistics (mean, std dev, max, min) for all variables that you use in your analysis (Hint: wait until you answer all of the other questions before finalizing this part). Write one paragraph describing your data using the numbers in this table. 

```{r}
df <- raw %>%
  filter(
    AGE >= 15,
    SEX == 2
  ) %>%
  mutate(
    CHSURV_CLEAN = if_else(CHSURV >= 90, NA_real_, CHSURV),

    CHILDREN_EVER_BORN = CHBORN,
    CHILDREN_SURVIVING = CHSURV_CLEAN,
    CHILDREN_DEAD = if_else(
      !is.na(CHILDREN_EVER_BORN) & !is.na(CHILDREN_SURVIVING),
      CHILDREN_EVER_BORN - CHILDREN_SURVIVING,
      NA_real_
    ),

    CM_RATE = if_else(
      CHILDREN_EVER_BORN > 0 & !is.na(CHILDREN_DEAD),
      CHILDREN_DEAD / CHILDREN_EVER_BORN,
      NA_real_
    ),

    EDUC_W = if_else(YRSCHOOL >= 90, NA_real_, YRSCHOOL),
    EDUC_SP = if_else(YRSCHOOL_SP >= 90, NA_real_, YRSCHOOL_SP),
    URBAN_D = if_else(URBAN == 1, 1, 0),

    ELECTRIC_D = case_when(
      ELECTRIC == 1 ~ 1,
      ELECTRIC == 2 ~ 0,
      TRUE          ~ NA_real_
    )
  ) %>%
  filter(
    !is.na(CM_RATE),
    !is.na(EDUC_W),
    !is.na(AGE),
    !is.na(URBAN_D),
    !is.na(ELECTRIC_D),
    !is.na(PERWT)
  )

vars_for_analysis <- df %>%
  select(
    CM_RATE,
    EDUC_W,
    EDUC_SP,
    AGE,
    URBAN_D,
    ELECTRIC_D,
    CHBORN,
    CHSURV_CLEAN,
    PERWT
  )
```
```{r}
summary_table_long <- vars_for_analysis %>%
  select(-PERWT) %>%    # simple unweighted summary
  pivot_longer(cols = everything()) %>%
  group_by(name) %>%
  summarise(
    mean = mean(value, na.rm = TRUE),
    sd   = sd(value,   na.rm = TRUE),
    min  = min(value,  na.rm = TRUE),
    max  = max(value,  na.rm = TRUE),
    .groups = "drop"
  )

summary_table_long

```
Ethiopian women who were married and at least 15 years old in 2007 make up the analytical sample. The average age of a woman is approximately 36.9 (sd ≈ 14.5, range 15–97). The average number of children born to women in the sample is 4.44 (sd ≈ 2.51), with values ranging from 1 to 9. Among women with at least one birth, the mean number of surviving children is 3.81 (sd ≈ 2.14, range 1–9). The constructed child mortality rate ranges from 0 (no child deaths) to 0.889 (about 8 deaths out of 9 births), with a mean of roughly 0.103 (sd ≈ 0.18). It is calculated by dividing the number of children who have died by the number of children who have been born.

This sample has extremely low levels of education. Husbands have an average of 1.84 years (sd ≈ 3.25, max 13) of education, while women have an average of 0.86 years (sd ≈ 2.42, max 13). Only about 13 percent of households have access to electricity (mean of the electricity dummy = 0.132), which is consistent with a generally poor, low-infrastructure setting. Based on the urban dummy used here, roughly 86 percent of women are classified as living in urban areas (mean of URBAN_D = 0.856). Overall, the summary statistics describe a high-fertility, low-education population with substantial variation in child mortality and household infrastructure.


2. Regress child mortality rate on women's education, include control variables for age, urban residence (create a dummy variable for residence in an urban area), and at least one other control variable of your choosing.  Tell me why you included that control variable and what you expect the sign to be for the the coefficients on that control variable.
```{r}
ols_mod <- lm(
  CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D,
  data    = df,
  weights = PERWT
)

summary(ols_mod)
```
I estimate a weighted OLS regression of the child mortality rate on women’s education and several controls:

$$
CM\_RATE_i = \beta_0 + \beta_1 EDUC\_W_i + \beta_2 AGE_i + \beta_3 URBAN\_D_i + \beta_4 ELECTRIC\_D_i + \varepsilon_i$, using $PERWT
$$

as person weights. The key explanatory variable is women’s years of schooling ($EDUC\_W$).

I control for $AGE$ because older women have had more time to accumulate births and potential child deaths, so even holding education constant, we expect higher exposure to mortality events at older ages.  As a result, I expected $AGE$ to have a positive coefficient.  Because urban areas usually have better access to clinics, hospitals, clean water, and other health-related infrastructure, I included an urban residence dummy ($URBAN\_D = 1$ if urban). I expected this to be associated with lower child mortality, so a negative coefficient on $URBAN\_D$.  Lastly, as a stand-in for household wealth and infrastructure, I include an electricity dummy ($ELECTRIC\_D = 1$ if the household has electricity). I anticipated that $ELECTRIC_D$ would also have a negative coefficient since households with electricity are probably wealthier and better able to invest in children's health.

3. Display your regression results from 2 in a table. Label your variables in the table and give your table a title.  Were the signs on the coefficients as expected? 
```{r}
ols_sum <- summary(ols_mod)

ols_table <- as.data.frame(ols_sum$coefficients)
ols_table$Variable <- rownames(ols_table)
rownames(ols_table) <- NULL
colnames(ols_table)[1:4] <- c("Estimate", "Std_Error", "t_value", "Pr_t")

ols_table_pretty <- ols_table %>%
  mutate(
    Variable = case_when(
      Variable == "(Intercept)" ~ "Intercept",
      Variable == "EDUC_W"      ~ "Years of schooling (woman)",
      Variable == "AGE"         ~ "Age",
      Variable == "URBAN_D"     ~ "Urban (=1)",
      Variable == "ELECTRIC_D"  ~ "Electricity (=1)",
      TRUE                      ~ Variable
    )
  ) %>%
  select(Variable, Estimate, Std_Error, t_value, Pr_t)

ols_table_pretty
```
Table 1 reports the weighted OLS regression of the child mortality rate on women’s years of schooling, controlling for age, urban residence, and electricity access.  The coefficient on women’s education is −0.00465 and highly statistically significant.  This suggests that an extra year of education is linked to a roughly 0.47 percentage point decrease in the child mortality rate, all other things being equal.  The expectation that mothers with higher levels of education have lower rates of child mortality is supported by the negative sign.

The idea that older women have had more time to experience child deaths is supported by the coefficient on age, which is 0.00361 and highly significant. This means that every extra year of age is linked to a 0.36 percentage point higher child mortality rate.  In contrast to my earlier prediction of lower mortality in urban areas, the coefficient on urban residence is positive (0.0070) and not statistically significant at conventional levels.  The electricity dummy is statistically insignificant despite having the anticipated negative sign (-0.00445).  While the coefficients on urban residence and electricity are weaker and less accurately estimated than expected, the signs for women's age and education are generally as expected.

4. Why might the estimated relationship between child mortality and women's education you estimated above be biased? Even though this is the data science section, draw on at least one of the course readings to support your argument.

Because education is not assigned at random, the negative OLS association between women's education and child mortality is unlikely to be solely causal.  Women who obtain more schooling tend to come from households with higher income, better nutrition, and stronger preferences for child quality, and they may live in communities with better health services.  These invisible traits have an impact on children's survival as well as their level of education.  The OLS coefficient on women's education will capture both the actual causal effect of education and the influence of these advantageous background factors, resulting in bias, if we fail to fully observe or account for them.

The concerns brought up in the course readings on health and education are strikingly similar to this one.  For example, in our reading on maternal education and child health (where the authors emphasize that more educated mothers also come from households with better health environments and higher permanent income), the authors argue that simple cross-sectional regressions overstate the causal impact of education because they confound schooling with family background and community characteristics.  Similarly, our OLS results for Ethiopia likely overestimate the amount that child mortality would decrease if we exogenously increased women's schooling because favorable family and community circumstances that are correlated with education rather than education itself account for a portion of the observed gap in child mortality.

5. Using her spouse's education as an instrumental variable for a woman's education, perform two stage least squares.  Display the results of your second stage in a table that meets the same criteria as the table you created in 3.

```{r}
library(AER)

iv_mod <- ivreg(
  CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D |
    EDUC_SP + AGE + URBAN_D + ELECTRIC_D,
  data    = df,
  weights = PERWT
)

summary(iv_mod, diagnostics = TRUE)
```
I estimate the following second–stage equation using two–stage least squares (2SLS):

$$
CM\_RATE_i = \beta_0 + \beta_1 EDUC\_W_i + \beta_2 AGE_i + \beta_3 URBAN\_D_i + \beta_4 ELECTRIC\_D_i + \varepsilon_i
$$
where $EDUC_W$ (woman’s years of schooling) is instrumented by $EDUC_SP$ (spouse’s years of schooling), and the controls $AGE$, $URBAN_D$, and $ELECTRIC_D$ enter both stages.  According to the weighted 2SLS results, women's education has a coefficient of $-0.00381$ (standard error $0.00118$, $p = 0.0013$).  This implies that, for the women whose schooling is shifted by their spouse’s education, an additional year of schooling is associated with roughly a $0.38$ percentage point reduction in the child mortality rate, holding age, urban residence, and electricity access constant.  The coefficient on $AGE$ remains positive and highly significant ($0.00311$), while the coefficients on $URBAN_D$ and $ELECTRIC_D$ are small and statistically insignificant, similar to the OLS results.

The diagnostic tests indicate that $EDUC_SP$ is an extremely strong instrument: the weak‐instrument $F$–statistic is about $5823$ with $p < 0.001$, far above conventional thresholds.  With a $p$–value of $0.882$ for the Wu–Hausman test, we are unable to reject the null hypothesis that OLS is consistent; in other words, there is no compelling statistical evidence that endogeneity of $EDUC_W$ is causing a significant discrepancy between the OLS and 2SLS estimates.  Consistent with this, the 2SLS estimate ($-0.0038$) is somewhat smaller in magnitude than the OLS estimate ($-0.0047$) but still negative and statistically significant.


6. Write one paragraph discussing how the results you found in your OLS and two stage least squares regressions (#2 and #5) relate to the theoretical model(s) learned in the course. Think of this as a practice run for your paper.

According to the theoretical models we covered in class, raising women's educational attainment should lower child mortality by enhancing maternal health and nutrition knowledge, changing preferences for high-quality children, and possibly bolstering women's negotiating power in the home.  This prediction is supported by both my OLS and 2SLS estimates; in each instance, the coefficient on $EDUC_W$ is negative and statistically significant, suggesting that lower child mortality is linked to higher maternal education.  The goal of the 2SLS method, which employs $EDUC_SP$ as a tool, is to separate the portion of women's education that is influenced by assortative matching in the marriage market as opposed to unreported family history. The fact that the 2SLS estimate is still negative and of comparable order of magnitude to the OLS estimate indicates that the observed relationship is not solely due to selection on unobservables and that further education improves child survival causally, at least for the "compliers" whose education responds to their spouse's education.  However, the Wu-Hausman test and the slight difference between OLS and 2SLS indicate relatively mild bias in the simple regression. Therefore, the overall empirical evidence supports the theoretical view that maternal education is a significant, though not exclusive, factor in lowering child mortality in this context.
