# Packages you will probably need
library(tidyverse)
library(janitor)
library(modelsummary)  # for nice tables
# Packages you will probably need
library(tidyverse)
library(janitor)
library(modelsummary)  # for nice tables
# Packages you will probably need
library(tidyverse)
library(janitor)
# Path to your file
# Use double backslashes or forward slashes in R:
data_path <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"
raw <- readr::read_csv(data_path)
# Take a quick look
glimpse(raw)
# Packages you will probably need
library(tidyverse)
library(janitor)
library(AER)           # for ivreg (2SLS)
# Packages you will probably need
library(tidyverse)
library(janitor)
# Path to your file
# Use double backslashes or forward slashes in R:
data_path <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"
raw <- readr::read_csv(data_path)
# Take a quick look
glimpse(raw)
# =========================
# 1. Clean data
# =========================
df <- raw %>%
# keep women age 15+ (should already be true)
filter(age >= 15,
sex == 2) %>%    # just to be safe: 2 = female in IPUMS
mutate(
# clean CHSURV: 99 is 'unknown' / missing
chsurv_clean = if_else(chsurv >= 90, NA_real_, chsurv),
# child deaths and child mortality rate
children_ever_born = chborn,
children_surviving = chsurv_clean,
children_dead      = if_else(
!is.na(children_ever_born) & !is.na(children_surviving),
children_ever_born - children_surviving,
NA_real_
),
cm_rate = if_else(
children_ever_born > 0 & !is.na(children_dead),
children_dead / children_ever_born,
NA_real_
),
# woman's years of schooling; codes >= 90 are missing
educ_w = if_else(yrschool >= 90, NA_real_, yrschool),
# spouse's years of schooling; again clean >= 90 as missing
educ_sp = if_else(yrschool_sp >= 90, NA_real_, yrschool_sp),
# urban dummy: URBAN==1 urban, URBAN==2 rural
urban_d = if_else(urban == 1, 1, 0),
# electricity dummy: ELECTRIC==1 has electricity, 2 = no, 0 = NIU/missing
electric_d = case_when(
electric == 1 ~ 1,
electric == 2 ~ 0,
TRUE          ~ NA_real_
)
) %>%
# drop rows with missing key variables for analysis
filter(
!is.na(cm_rate),
!is.na(educ_w),
!is.na(age),
!is.na(urban_d),
!is.na(electric_d),
!is.na(perwt)       # for weights if we want them
)
# =========================
# 1. Clean data
# =========================
df <- raw %>%
# ever-married women age 15+, female only
filter(
AGE >= 15,
SEX == 2
) %>%
mutate(
# clean CHSURV: 99 = unknown / missing
CHSURV_CLEAN = if_else(CHSURV >= 90, NA_real_, CHSURV),
# children ever born / surviving / dead
CHILDREN_EVER_BORN = CHBORN,
CHILDREN_SURVIVING = CHSURV_CLEAN,
CHILDREN_DEAD = if_else(
!is.na(CHILDREN_EVER_BORN) & !is.na(CHILDREN_SURVIVING),
CHILDREN_EVER_BORN - CHILDREN_SURVIVING,
NA_real_
),
# child mortality rate (only if at least 1 birth)
CM_RATE = if_else(
CHILDREN_EVER_BORN > 0 & !is.na(CHILDREN_DEAD),
CHILDREN_DEAD / CHILDREN_EVER_BORN,
NA_real_
),
# woman's years of schooling (YRSCHOOL), clean ≥ 90
EDUC_W = if_else(YRSCHOOL >= 90, NA_real_, YRSCHOOL),
# spouse's years of schooling (instrument), clean ≥ 90
EDUC_SP = if_else(YRSCHOOL_SP >= 90, NA_real_, YRSCHOOL_SP),
# urban dummy: URBAN == 1 -> 1, URBAN == 2 -> 0
URBAN_D = if_else(URBAN == 1, 1, 0),
# electricity dummy: ELECTRIC == 1 (yes), 2 (no), 0 (NIU)
ELECTRIC_D = case_when(
ELECTRIC == 1 ~ 1,
ELECTRIC == 2 ~ 0,
TRUE          ~ NA_real_
)
) %>%
# drop missing on key variables
filter(
!is.na(CM_RATE),
!is.na(EDUC_W),
!is.na(AGE),
!is.na(URBAN_D),
!is.na(ELECTRIC_D),
!is.na(PERWT)
)
# Variables used in analysis
vars_for_analysis <- df %>%
select(
CM_RATE,
EDUC_W,
EDUC_SP,
AGE,
URBAN_D,
ELECTRIC_D,
CHBORN,
CHSURV_CLEAN,
PERWT
)
summary_table_long <- vars_for_analysis %>%
select(-PERWT) %>%    # simple unweighted summary
pivot_longer(cols = everything()) %>%
group_by(name) %>%
summarise(
mean = mean(value, na.rm = TRUE),
sd   = sd(value,   na.rm = TRUE),
min  = min(value,  na.rm = TRUE),
max  = max(value,  na.rm = TRUE),
.groups = "drop"
)
summary_table_long
library(tidyverse)
data_path <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"
raw <- readr::read_csv(data_path)
df <- raw %>%
filter(
AGE >= 15,
SEX == 2
) %>%
mutate(
CHSURV_CLEAN = if_else(CHSURV >= 90, NA_real_, CHSURV),
CHILDREN_EVER_BORN = CHBORN,
CHILDREN_SURVIVING = CHSURV_CLEAN,
CHILDREN_DEAD = if_else(
!is.na(CHILDREN_EVER_BORN) & !is.na(CHILDREN_SURVIVING),
CHILDREN_EVER_BORN - CHILDREN_SURVIVING,
NA_real_
),
CM_RATE = if_else(
CHILDREN_EVER_BORN > 0 & !is.na(CHILDREN_DEAD),
CHILDREN_DEAD / CHILDREN_EVER_BORN,
NA_real_
),
EDUC_W = if_else(YRSCHOOL >= 90, NA_real_, YRSCHOOL),
EDUC_SP = if_else(YRSCHOOL_SP >= 90, NA_real_, YRSCHOOL_SP),
URBAN_D = if_else(URBAN == 1, 1, 0),
ELECTRIC_D = case_when(
ELECTRIC == 1 ~ 1,
ELECTRIC == 2 ~ 0,
TRUE          ~ NA_real_
)
) %>%
filter(
!is.na(CM_RATE),
!is.na(EDUC_W),
!is.na(AGE),
!is.na(URBAN_D),
!is.na(ELECTRIC_D),
!is.na(PERWT)
)
vars_for_analysis <- df %>%
select(
CM_RATE,
EDUC_W,
EDUC_SP,
AGE,
URBAN_D,
ELECTRIC_D,
CHBORN,
CHSURV_CLEAN,
PERWT
)
summary_table_long <- vars_for_analysis %>%
select(-PERWT) %>%    # simple unweighted summary
pivot_longer(cols = everything()) %>%
group_by(name) %>%
summarise(
mean = mean(value, na.rm = TRUE),
sd   = sd(value,   na.rm = TRUE),
min  = min(value,  na.rm = TRUE),
max  = max(value,  na.rm = TRUE),
.groups = "drop"
)
summary_table_long
# =========================
# 2. OLS regression
# =========================
ols_mod <- lm(
CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D,
data    = df,
weights = PERWT
)
summary(ols_mod)
ols_mod <- lm(
CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D,
data    = df,
weights = PERWT
)
summary(ols_mod)
ols_sum <- summary(ols_mod)
ols_table <- as.data.frame(ols_sum$coefficients)
ols_table$Variable <- rownames(ols_table)
rownames(ols_table) <- NULL
colnames(ols_table)[1:4] <- c("Estimate", "Std_Error", "t_value", "Pr_t")
ols_table_pretty <- ols_table %>%
mutate(
Variable = case_when(
Variable == "(Intercept)" ~ "Intercept",
Variable == "EDUC_W"      ~ "Years of schooling (woman)",
Variable == "AGE"         ~ "Age",
Variable == "URBAN_D"     ~ "Urban (=1)",
Variable == "ELECTRIC_D"  ~ "Electricity (=1)",
TRUE                      ~ Variable
)
) %>%
select(Variable, Estimate, Std_Error, t_value, Pr_t)
ols_table_pretty
ols_sum <- summary(ols_mod)
ols_table <- as.data.frame(ols_sum$coefficients)
ols_table$Variable <- rownames(ols_table)
rownames(ols_table) <- NULL
colnames(ols_table)[1:4] <- c("Estimate", "Std_Error", "t_value", "Pr_t")
ols_table_pretty <- ols_table %>%
mutate(
Variable = case_when(
Variable == "(Intercept)" ~ "Intercept",
Variable == "EDUC_W"      ~ "Years of schooling (woman)",
Variable == "AGE"         ~ "Age",
Variable == "URBAN_D"     ~ "Urban (=1)",
Variable == "ELECTRIC_D"  ~ "Electricity (=1)",
TRUE                      ~ Variable
)
) %>%
select(Variable, Estimate, Std_Error, t_value, Pr_t)
ols_table_pretty
library(AER)
install.packages("AER")
library(AER)
iv_mod <- ivreg(
CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D |
EDUC_SP + AGE + URBAN_D + ELECTRIC_D,
data    = df,
weights = PERWT
)
summary(iv_mod, diagnostics = TRUE)
library(AER)
iv_mod <- ivreg(
CM_RATE ~ EDUC_W + AGE + URBAN_D + ELECTRIC_D |
EDUC_SP + AGE + URBAN_D + ELECTRIC_D,
data    = df,
weights = PERWT
)
summary(iv_mod, diagnostics = TRUE)
library(tidyverse)
data_path <- "C:/Users/alexl/OneDrive/Desktop/Desktop/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"
raw <- readr::read_csv(data_path)
library(tidyverse)
data_path <- "C:/Users/alexl/OneDrive/Desktop/桌面/UW/CourseWork/Senior Year/Autumn 2025/ECON 448/Problem Set 4/ipumsi_00003.csv.gz"
raw <- readr::read_csv(data_path)
